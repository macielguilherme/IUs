<!DOCTYPE html> 
<html lang="pt-br">
   <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>IU1 - Atribuição (Mobile)</title>
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
      <link rel="stylesheet" href="styles.css">
   </head>
   <body>
      <!-- SCANNER TRAP --> <input type="text" id="scannerTrap" class="scanner-trap" autocomplete="off" inputmode="none"> <!-- MOBILE MOCKUP --> 
      <div class="mobile-mockup">
         <div class="status-bar-mockup">
            <span id="clock-mockup">10:27</span> 
            <div style="display: flex; gap: 6px;"> <i class="bi bi-wifi"></i> <i class="bi bi-battery-full"></i> </div>
         </div>
         <div class="app-screen-content">
            <!-- TELA PRINCIPAL --> 
            <div class="work-card" id="tela-principal">
               <div class="segmented-progress-wrapper">
                  <div class="segments-container" id="segmentsContainer">
                     <!-- Segmentos renderizados via JS --> 
                  </div>
                  <div class="progress-info"> <span class="step-name-display" id="stepNameDisplay">Atribuição</span> <span class="step-counter" id="stepCounterDisplay">1/7</span> </div>
               </div>
               <hr style="margin: 10px 0; border-top: 1px solid #eee;">
               <h4>Atribuição da O.S</h4>
               <!-- PILLS DE STATUS (ORIGINAL DO IU1) --> 
               <div style="margin: 10px 0 20px 0; display: flex; gap: 8px;"> <span class="status-pill" id="pillOS">O.S pendente</span> <span class="status-pill" id="pillCracha">Crachá pendente</span> </div>
               <!-- MENSAGEM DE ERRO --> 
               <div id="msgErro" class="msg-erro"> <i class="bi bi-exclamation-triangle-fill me-2"></i> <span id="txtErro">Erro</span> </div>
               <!-- 3 OPÇÕES DE ENTRADA --> 
               <div class="action-buttons-grid" id="opcoesEntrada">
                  <div class="btn-action-mode active" onclick="setOpMode('camera', this)"> <i class="bi bi-camera"></i> <span>Câmera</span> </div>
                  <div class="btn-action-mode" onclick="setOpMode('digitar', this)"> <i class="bi bi-keyboard"></i> <span>Digitar</span> </div>
                  <div class="btn-action-mode" onclick="setOpMode('leitor', this)"> <i class="bi bi-upc-scan"></i> <span>Leitor</span> </div>
               </div>
               <!-- ÁREA DE LEITURA (APARECE APENAS NO INÍCIO) --> 
               <div id="areaLeitura" class="dashed-area" style="min-height: 80px; padding: 20px; display: flex; flex-direction: column; align-items: center; justify-content: center; margin-top: 15px;"> <i class="bi bi-upc-scan" style="font-size: 24px; color: var(--cor-secundaria);"></i> <span style="margin-top: 10px;">Aguardando leitura...</span> </div>
               <!-- LISTA DE O.S (INICIALMENTE ESCONDIDA) --> 
               <div id="areaLista" style="display: none;">
                  <div class="list-header"> <span class="label-passo" style="font-size: 12px; margin: 0; font-weight: 700;">O.S LIDAS</span> <span style="font-size: 11px; color: var(--cor-secundaria);" id="contadorItens">0</span> </div>
                  <div class="dashed-area" id="containerLista">
                     <div id="msgVazio" style="text-align: center; margin-top: 40px; color: #ccc; font-size: 12px;"> Nenhuma O.S bipada </div>
                     <div id="listaConteudo" style="width: 100%; display: none;"></div>
                  </div>
               </div>
               <!-- BOTÃO PARA IDENTIFICAR RESPONSÁVEL (COM MAIS ESPAÇO ACIMA) --> <button class="btn-white-big" id="btnIdentificar" onclick="identificarResponsavel()" disabled> <i class="bi bi-person-badge"></i> <span>Identificar Responsável</span> </button> <!-- BOTÃO FINALIZAR (COM MAIS ESPAÇO ACIMA) --> <button class="btn-green-block" id="btnFinalizar" onclick="finalizarAtribuicao()" style="display: none;">Disponibilizar para Separação</button> 
            </div>
            <!-- TELA DE SUCESSO ESTILO IU2 PARA IU1 --> 
            <div id="tela-sucesso" class="work-card" style="display: none;">
               <div class="success-internal-container" style="display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding-top: 40px;">
                  <!-- CÍRCULO VERDE COM CHECK --> 
                  <div style="width: 100px; height: 100px; background: var(--cor-principal); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-bottom: 25px; box-shadow: 0 4px 15px rgba(39, 174, 97, 0.3);"> <i class="bi bi-check-lg" style="font-size: 50px; color: white;"></i> </div>
                  <!-- TÍTULO E SUBTÍTULO --> 
                  <h4 style="margin-bottom: 5px; font-size: 22px; color: #2c3e50;">Atribuição Concluída</h4>
                  <p style="font-size: 14px; color: var(--cor-off); margin-bottom: 25px;"> O.S foram disponibilizadas para separação com sucesso. </p>
                  <!-- CAIXA DE RESUMO --> 
                  <div style="background: var(--cor-bg-item); border: 1px solid var(--cor-borda); padding: 20px; width: 90%; max-width: 400px; border-radius: 12px; text-align: left; margin-bottom: 25px;">
                     <div style="display: flex; justify-content: space-between; margin-bottom: 10px;"> <span style="color: var(--cor-off); font-size: 14px;">Total O.S</span> <strong id="resumoTotal" style="color: #333;">0</strong> </div>
                     <div style="display: flex; justify-content: space-between;"> <span style="color: var(--cor-off); font-size: 14px;">Responsável</span> <strong id="resumoResponsavel" style="color: var(--cor-principal);">-</strong> </div>
                  </div>
                  <!-- BOTÃO NOVA ATRIBUIÇÃO --> <!-- BOTÃO NOVA ATRIBUIÇÃO --> <button class="btn-white-big" style="width: 90%; max-width: 400px; margin-top: 10px;" onclick="window.location.href='iu2.html'"> Nova Atribuição </button> 
               </div>
            </div>
         </div>
         <!-- BOTTOM SHEET PARA DIGITAÇÃO --> 
         <div id="bottomSheet" class="bottom-sheet-overlay">
            <div class="bottom-sheet"> <span style="font-size: 14px; font-weight: 700; color: #333; display: block; margin-bottom: 12px;"> Digite o código </span> <input type="text" id="bsInput" class="bs-input" autocomplete="off" placeholder="Digite a O.S..." style="font-size: 15px; text-transform: uppercase;"> <button class="btn-green-block" onclick="confirmarDigitacao()" style="margin-top: 5px;">OK</button> </div>
         </div>
      </div>
      <script> // --- CONFIGURAÇÃO DE ÁUDIO --- const audioSuccess = new Audio("audio/beep.mp3"); const audioError = new Audio("audio/erro.mp3"); function playSound(type) { try { if (type === 'success') { audioSuccess.currentTime = 0; audioSuccess.play().catch(() => console.log('Autoplay blocked')); } else if (type === 'error') { audioError.currentTime = 0; audioError.play().catch(() => console.log('Autoplay blocked')); } } catch (e) { console.error("Erro ao tocar áudio", e); } } // --- ESTADO GLOBAL --- let listaOS = []; let modoDigitacaoAtivo = false; let responsavel = null; let primeiraLeituraFeita = false; const etapas = [ "Atribuição", "Separação", "Conferência", "Paletização", "Carga", "Transporte", "Entrega" ]; // ELEMENTOS DOM const scannerTrap = document.getElementById('scannerTrap'); const bottomSheet = document.getElementById('bottomSheet'); const bsInput = document.getElementById('bsInput'); const contadorItens = document.getElementById('contadorItens'); const pillOS = document.getElementById('pillOS'); const pillCracha = document.getElementById('pillCracha'); const btnIdentificar = document.getElementById('btnIdentificar'); const btnFinalizar = document.getElementById('btnFinalizar'); const areaLeitura = document.getElementById('areaLeitura'); const areaLista = document.getElementById('areaLista'); // INICIALIZAÇÃO window.onload = () => { updateClockMockup(); setInterval(updateClockMockup, 1000); renderProgress(); focarScanner(); }; function updateClockMockup() { const now = new Date(); document.getElementById('clock-mockup').innerText = String(now.getHours()).padStart(2, '0') + ':' + String(now.getMinutes()).padStart(2, '0'); } function renderProgress() { const container = document.getElementById('segmentsContainer'); container.innerHTML = ''; const stepIndex = 0; // IU1 = Atribuição etapas.forEach((_, index) => { const seg = document.createElement('div'); seg.classList.add('segment'); if (index === stepIndex) seg.classList.add('active'); container.appendChild(seg); }); document.getElementById('stepNameDisplay').innerText = etapas[stepIndex]; document.getElementById('stepCounterDisplay').innerText = ${stepIndex + 1}/${etapas.length}; } // --- CAPTURA DE LEITURA (SCANNER TRAP) --- scannerTrap.addEventListener('keypress', (e) => { if (e.key === 'Enter') { const val = scannerTrap.value.trim().toUpperCase(); scannerTrap.value = ''; if (!val) return; processarLeitura(val); } }); function focarScanner() { if (!modoDigitacaoAtivo) { scannerTrap.focus(); } } // --- LÓGICA DE LEITURA --- function processarLeitura(codigo) { if (codigo.length < 2) { mostrarErro("Código inválido"); playSound('error'); return; } // Verificar se já existe if (listaOS.includes(codigo)) { mostrarErro("O.S já bipada"); playSound('error'); return; } // Adicionar à lista listaOS.push(codigo); playSound('success'); // Se for a primeira leitura, esconde área de leitura e mostra lista if (!primeiraLeituraFeita) { primeiraLeituraFeita = true; areaLeitura.style.display = 'none'; areaLista.style.display = 'block'; btnFinalizar.style.display = 'block'; } atualizarLista(); focarScanner(); } function atualizarLista() { const divConteudo = document.getElementById('listaConteudo'); const msgVazio = document.getElementById('msgVazio'); const container = document.getElementById('containerLista'); contadorItens.innerText = listaOS.length; // Atualizar pill de O.S if (listaOS.length > 0) { pillOS.classList.add('check'); pillOS.innerText = ${listaOS.length} O.S bipada${listaOS.length > 1 ? 's' : ''}; } else { pillOS.classList.remove('check'); pillOS.innerText = "O.S pendente"; } // Habilitar botão de identificar se houver O.S btnIdentificar.disabled = listaOS.length === 0; if (listaOS.length === 0) { msgVazio.style.display = 'block'; divConteudo.style.display = 'none'; return; } msgVazio.style.display = 'none'; divConteudo.style.display = 'block'; let html = ''; listaOS.forEach((os, index) => { const isLast = index === listaOS.length - 1; html += <div class="os-item ${isLast ? 'current' : ''}" style="height:36px;"> <div class="os-left"> <span class="os-caixa">${os}</span> </div> <button class="btn-remove" onclick="removerOS(${index})"><i class="bi bi-x-lg"></i></button> </div> ; }); divConteudo.innerHTML = html; // Scroll automático if (listaOS.length > 4) { setTimeout(() => { container.scrollTop = container.scrollHeight; }, 50); } } function removerOS(index) { listaOS.splice(index, 1); atualizarLista(); focarScanner(); // Se remover todas as O.S, volta para estado inicial if (listaOS.length === 0) { primeiraLeituraFeita = false; areaLeitura.style.display = 'flex'; areaLista.style.display = 'none'; btnFinalizar.style.display = 'none'; responsavel = null; pillCracha.classList.remove('check'); pillCracha.innerText = "Crachá pendente"; btnIdentificar.disabled = true; btnIdentificar.classList.remove('active-scan'); btnIdentificar.innerHTML = <i class="bi bi-person-badge"></i><span>Identificar Responsável</span>; } } // --- IDENTIFICAÇÃO DO RESPONSÁVEL --- function identificarResponsavel() { // Simulação de leitura de crachá const operadores = ["OPERADOR 01", "OPERADOR 02", "OPERADOR 03"]; const operador = operadores[Math.floor(Math.random() * operadores.length)]; responsavel = operador; pillCracha.classList.add('check'); pillCracha.innerText = Responsável: ${operador}; btnIdentificar.classList.add('active-scan'); btnIdentificar.innerHTML = <i class="bi bi-check-circle-fill"></i> ${operador}; playSound('success'); } // --- FINALIZAR ATRIBUIÇÃO --- function finalizarAtribuicao() { // Garantias mínimas (protótipo) if (listaOS.length === 0) listaOS.push('TESTE'); if (!responsavel) responsavel = 'OPERADOR 01'; // Troca de telas document.getElementById('tela-principal').style.display = 'none'; document.getElementById('tela-sucesso').style.display = 'block'; // Atualiza resumo document.getElementById('resumoTotal').innerText = listaOS.length; document.getElementById('resumoResponsavel').innerText = responsavel; // Feedback sonoro (opcional, mas padrão WMS) playSound('success'); // ⏱️ Aguarda 2 segundos e avança automaticamente setTimeout(() => { window.location.href = 'iu2.html'; }, 2000); } // --- UTILITÁRIOS UI --- function mostrarErro(msg) { const el = document.getElementById('msgErro'); const txt = document.getElementById('txtErro'); el.className = 'msg-erro erro-permissao'; el.style.display = 'flex'; txt.innerText = msg; setTimeout(() => { el.style.display = 'none'; }, 2500); } function setOpMode(mode, btn) { document.querySelectorAll('#opcoesEntrada .btn-action-mode').forEach(b => b.classList.remove('active')); if (btn) btn.classList.add('active'); if (mode === 'digitar') { ativarInputManual(); } else if (mode === 'camera') { alert("Módulo de câmera acionado"); focarScanner(); } else { focarScanner(); } } function ativarInputManual() { modoDigitacaoAtivo = true; bottomSheet.style.display = 'flex'; bsInput.value = ''; setTimeout(() => bsInput.focus(), 150); } function confirmarDigitacao() { const val = bsInput.value.trim().toUpperCase(); if (!val) return; bottomSheet.style.display = 'none'; modoDigitacaoAtivo = false; processarLeitura(val); focarScanner(); } // EVENT LISTENERS bsInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') confirmarDigitacao(); }); bottomSheet.addEventListener('click', (e) => { if (e.target === bottomSheet) { bottomSheet.style.display = 'none'; modoDigitacaoAtivo = false; focarScanner(); } }); </script> 
   </body>
</html>
